USE DEMO;
GO

DROP TABLE IF EXISTS #dates;

CREATE TABLE #dates (
    line nvarchar(3), 
    from_date DATETIME, 
    to_date DATETIME
);

INSERT #dates VALUES 
--Here dates are different (few days)
('G01', '2013-11-25 04:05:27.000','2013-11-28 04:06:34.000'),--date start < 5:00:00 and date end < 5:00:00
('G02', '2012-11-21 14:11:09.220','2012-11-23 14:48:28.733'),--date start > 5:00:00 and date end > 5:00:00
('G03', '2016-05-18 03:00:00.000','2016-05-20 07:00:00.000'),--date start < 5:00:00 and date end > 5:00:00
('G04', '2013-11-25 05:05:27.000','2013-11-27 04:06:34.000'),--date start > 5:00:00 and date end < 5:00:00
--Here dates are equal
('G05', '2013-11-25 04:05:27.000','2013-11-25 04:06:34.000'),--date start < 5:00:00 and date end < 5:00:00
('G06', '2014-01-02 23:24:07.120','2014-01-02 23:25:28.130'),--date start > 5:00:00 and date end > 5:00:00
('G07', '2014-01-02 02:24:07.120','2014-01-02 23:25:28.130'),--date start < 5:00:00 and date end > 5:00:00
--Here dates are different (1 day)
('G08', '2014-01-02 23:24:07.120 ','2014-01-03 00:25:28.130'),--date start > 5:00:00 and date end > 5:00:00
('G09', '2014-01-02 04:24:07.120 ','2014-01-03 00:25:28.130'),--date start < 5:00:00 and date end < 5:00:00
('G10', '2014-01-02 04:24:07.120 ','2014-01-03 06:25:28.130');--date start < 5:00:00 and date end > 5:00:00

WITH cte AS (
SELECT line,
       from_date,
       CASE WHEN DATEPART(hour, from_date) < 5 AND CAST(from_date as date) != CAST(to_date as date)
                THEN CAST(CONVERT(nvarchar(10),from_date,20) + ' 04:59:59.000' as datetime)
            WHEN CAST(from_date as date) = CAST(to_date as date) OR DATEPART(hour, to_date) < 5 AND DATEDIFF(day,from_date,to_date) <=1
                THEN to_date
            ELSE CAST(CONVERT(nvarchar(10),DATEADD(day,1,from_date),20) + ' 04:59:59.000' as datetime) END as new_to_date,
       to_date
FROM #dates
UNION ALL 
SELECT line,
       CAST(CONVERT(nvarchar(10),new_to_date,20) + ' 05:00:00.000' as datetime),
       CASE WHEN CAST(CONVERT(nvarchar(10),DATEADD(day,1,new_to_date),20) + ' 04:59:59.000' as datetime) > to_date
                THEN to_date 
            ELSE CAST(CONVERT(nvarchar(10),DATEADD(day,1,new_to_date),20) + ' 04:59:59.000' as datetime) END,
       to_date
FROM cte
WHERE to_date > new_to_date
)

SELECT line,
       from_date,
       new_to_date as to_date
FROM cte 
ORDER BY line, from_date

--* line    from_date                to_date
--? ('G01', '2013-11-25 04:05:27.000','2013-11-28 04:06:34.000'),
--? date start < 5:00:00 and date end < 5:00:00
--* G01     2013-11-25 04:05:27.000  2013-11-25 04:59:59.000
--* G01     2013-11-25 05:00:00.000  2013-11-26 04:59:59.000
--* G01     2013-11-26 05:00:00.000  2013-11-27 04:59:59.000
--* G01     2013-11-27 05:00:00.000  2013-11-28 04:06:34.000
--? ('G02', '2012-11-21 14:11:09.220','2012-11-23 14:48:28.733'),
--? date start > 5:00:00 and date end > 5:00:00
--* G02     2012-11-21 14:11:09.220  2012-11-22 04:59:59.000
--* G02     2012-11-22 05:00:00.000  2012-11-23 04:59:59.000
--* G02     2012-11-23 05:00:00.000  2012-11-23 14:48:28.733
--? ('G03', '2016-05-18 03:00:00.000','2016-05-20 07:00:00.000'),
--? date start < 5:00:00 and date end > 5:00:00
--* G03     2016-05-18 03:00:00.000  2016-05-18 04:59:59.000
--* G03     2016-05-18 05:00:00.000  2016-05-19 04:59:59.000
--* G03     2016-05-19 05:00:00.000  2016-05-20 04:59:59.000
--* G03     2016-05-20 05:00:00.000  2016-05-20 07:00:00.000
--? ('G04', '2013-11-25 05:05:27.000','2013-11-27 04:06:34.000'),
--? date start > 5:00:00 and date end < 5:00:00
--* G04     2013-11-25 05:05:27.000  2013-11-26 04:59:59.000
--* G04     2013-11-26 05:00:00.000  2013-11-27 04:06:34.000
--? ('G05', '2013-11-25 04:05:27.000','2013-11-25 04:06:34.000'),
--? date start < 5:00:00 and date end < 5:00:00
--* G05     2013-11-25 04:05:27.000  2013-11-25 04:06:34.000
--? ('G06', '2014-01-02 23:24:07.120','2014-01-02 23:25:28.130'),
--? date start > 5:00:00 and date end > 5:00:00
--* G06     2014-01-02 23:24:07.120  2014-01-02 23:25:28.130
--? ('G07', '2014-01-02 02:24:07.120','2014-01-02 23:25:28.130'),
--? date start < 5:00:00 and date end > 5:00:00
--* G07     2014-01-02 02:24:07.120  2014-01-02 23:25:28.130
--? ('G08', '2014-01-02 23:24:07.120 ','2014-01-03 00:25:28.130'),
--? date start > 5:00:00 and date end > 5:00:00
--* G08     2014-01-02 23:24:07.120  2014-01-03 00:25:28.130
--? ('G09', '2014-01-02 04:24:07.120 ','2014-01-03 00:25:28.130'),
--? date start < 5:00:00 and date end < 5:00:00
--* G09     2014-01-02 04:24:07.120  2014-01-02 04:59:59.000
--* G09     2014-01-02 05:00:00.000  2014-01-03 00:25:28.130
--? ('G10', '2014-01-02 04:24:07.120 ','2014-01-03 06:25:28.130')
--? date start < 5:00:00 and date end > 5:00:00
--* G10     2014-01-02 04:24:07.120  2014-01-02 04:59:59.000
--* G10     2014-01-02 05:00:00.000  2014-01-03 04:59:59.000
--* G10     2014-01-03 05:00:00.000  2014-01-03 06:25:28.130